<mat-card class="shipping-card var-main-gris mb-4em" *ngIf="novedad">
  <mat-card-header class="header-card header-card--margin">
    <mat-card-title class="header-card--text">
      Datos del contrato
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p *ngIf="novedad.contrato.contratacion.contratista != null">
      <strong>
        Nombre del contratista:
      </strong>
      {{ novedad.contrato.contratacion.contratista.nombre }}
    </p>
    <p *ngIf="novedad.contrato.contratacion.contratista != null">
      <strong>Tipo de identificación:</strong>
      <span>
        {{ novedad.contrato.contratacion.contratista.tipoIdentificacionNotMapped }}
      </span>
    </p>
    <p *ngIf="novedad.contrato.contratacion.contratista != null">
      <strong>
        Número de identificación
      </strong>
      {{ novedad.contrato.contratacion.contratista.numeroIdentificacion }}
    </p>
    <p *ngIf="novedad.proyectosContrato.length > 0">
      <strong>Tipo de intervención:</strong>
      <span>
        {{ novedad.proyectosContrato[0].tipoIntervencion }}
      </span>
    </p>
    <p>
      <strong>Valor del contrato:</strong>
      <span>{{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.valorTotalContrato | currency: '':'symbol':'3.0' }}</span>
    </p>
    <p>
      <strong>Plazo:</strong>
      <span>
        {{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.plazoEstimadoMesesProyecto }} Meses
        {{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.plazoEstimadoDiasProyecto }} Días
      </span>
    </p>
    <p>
      <strong>Fecha de inicio de contrato:</strong>
      {{ (novedad.contrato?.fechaActaInicioFase2 ? novedad.contrato?.fechaActaInicioFase2 : novedad.contrato?.fechaActaInicioFase1) | date:'dd/MM/yyyy'}}
    </p>
    <p>
      <strong>Fecha de finalización de contrato:</strong>
      {{ (novedad?.datosContratoProyectoModificadosXNovedad[0]?.fechaFinContrato) | date:'dd/MM/yyyy'}}
    </p>
    <p>
      <strong>Fecha estimada de finalización de contrato:</strong>
      {{ (novedad?.datosContratoProyectoModificadosXNovedad[0]?.fechaEstimadaFinContrato) | date:'dd/MM/yyyy'}}
    </p>

    <div *ngIf="novedad.esAplicadaAcontrato !== true">
    <h2 class="card-subTitle">Proyecto asociado</h2>
    <div class="table-responsive mb-2em px-table">
      <table class="mat-table cdk-table mat-sort mat-table-style table-form table-form--2 table-gris">
        <thead>
          <tr class="mat-header-row cdk-header-row ng-star-inserted">
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Llave MEN
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Departamento
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Municipio
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Institucion Educativa
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Sede
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Fecha de inicio de proyecto
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Fecha de finalización de proyecto
            </th>
            <th class="mat-header-cell cdk-header-cell ng-star-inserted">
              Fecha estimada de finalización de proyecto
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad.proyectosSeleccionado.llaveMen }}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad.proyectosSeleccionado.departamento }}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad.proyectosSeleccionado.municipio }}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad.proyectosSeleccionado.institucionEducativa }}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad.proyectosSeleccionado.sede }}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.fechaInicioProyecto | date:'dd/MM/yyyy'}}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.fechaFinProyecto | date:'dd/MM/yyyy'}}
            </td>
            <td class="mat-cell cdk-cell ng-star-inserted">
              {{ novedad?.datosContratoProyectoModificadosXNovedad[0]?.fechaEstimadaFinProyecto | date:'dd/MM/yyyy'}}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="shipping-card var-main-gris" *ngIf="novedad">
  <mat-card-header class="header-card header-card--margin">
    <mat-card-title class="header-card--text">
      Registro de novedad
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>
      <strong>
        Fecha de solicitud de la novedad:
      </strong>
      {{ novedad.fechaSolictud | date: 'dd/MM/yyyy' }}
    </p>
    <p>
      <strong>
        Instancia donde se presentó la solicitud:
      </strong>
      <span>
        {{ novedad.instanciaNombre }}
      </span>
    </p>
    <p *ngIf="novedad.instanciaNombre !== 'No aplica'">
      <strong>
        Fecha de la sesión de la instancia:
      </strong>
      {{ novedad.fechaSesionInstancia | date: 'dd/MM/yyyy' }}
    </p>
    <p>
      <strong> Tipo de Novedad: </strong>
      <span *ngFor="let tipoNovedad of novedad.novedadContractualDescripcion; let i = index">
        {{ tipoNovedad.nombreTipoNovedad
        }}<span *ngIf="i + 1 !== novedad.novedadContractualDescripcion.length">,</span>
      </span>
    </p>

  </mat-card-content>
</mat-card>
<mat-accordion *ngIf="novedad">
  <mat-expansion-panel class="expansion-style sub-expansion" *ngFor=" let descripcion of novedad.novedadContractualDescripcion; let i = index; ">
    <mat-expansion-panel-header class="expansion-style--header">
      <mat-panel-title class="expansion-style--title">
        Novedad {{ 1 + i }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <mat-card class="shipping-card var-main-gris">
      <mat-card-header class="header-card header-card--margin">
        <mat-card-title class="header-card--text textoGris">
          {{ descripcion.nombreTipoNovedad }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <strong>Motivos de la novedad:</strong>
            <section *ngFor="let motivo of descripcion.novedadContractualDescripcionMotivo; let i = index">
              {{ motivo.nombreMotivo
              }}<span *ngIf="i + 1 !== descripcion.novedadContractualDescripcionMotivo.length">,</span>
            </section>

        <p><strong>Resumen de la justificación de la novedad: </strong></p>
          <section
                  [innerHTML]="descripcion.resumenJustificacion"
                  style="margin-left: 2em"
          ></section>
        <mat-card-title
          class="header-card--text sub-text"
          *ngIf="
            descripcion.tipoNovedadCodigo == '1' ||
            descripcion.tipoNovedadCodigo == '2' ||
            descripcion.tipoNovedadCodigo == '4' ||
            descripcion.tipoNovedadCodigo == '6'
          "
        >
          Plazo solicitado
        </mat-card-title>
        <p *ngIf="descripcion.tipoNovedadCodigo == '4'"><strong>plazo adicional meses: </strong> {{ descripcion.plazoAdicionalMeses }}</p>
        <p *ngIf="descripcion.tipoNovedadCodigo == '4'"><strong>plazo adicional días: </strong> {{ descripcion.plazoAdicionalDias }}</p>

        <p  *ngIf="descripcion.tipoNovedadCodigo == '4'">
          <strong >
            Plazo después de la modificación:
          </strong>
          {{ valuePlazoProyecto(descripcion.plazoAdicionalMeses, descripcion.plazoAdicionalDias) }}
        </p>

        <p *ngIf="descripcion.tipoNovedadCodigo == '1' || descripcion.tipoNovedadCodigo == '2'">
          <strong *ngIf="descripcion.tipoNovedadCodigo == '1'">Fecha de inicio de la suspensión: </strong>
          <strong *ngIf="descripcion.tipoNovedadCodigo == '2'">Fecha de inicio de la prórroga a las suspensión: </strong>
          {{ descripcion.fechaInicioSuspension | date: 'dd/MM/yyyy' }}
        </p>
        <p *ngIf="descripcion.tipoNovedadCodigo == '1' || descripcion.tipoNovedadCodigo == '2'">
          <strong *ngIf="descripcion.tipoNovedadCodigo == '1'">Fecha final de la suspensión: </strong>
          <strong *ngIf="descripcion.tipoNovedadCodigo == '2'">Fecha final de la prórroga a las suspensión: </strong>
          {{ descripcion.fechaFinSuspension | date: 'dd/MM/yyyy' }}
        </p>

        <p *ngIf="((descripcion.tipoNovedadCodigo == '1' || descripcion.tipoNovedadCodigo == '2') && !((novedad?.estadoCodigo == '26' && novedad?.vaComite) || (novedad?.estadoCodigo == '25' && !novedad?.vaComite)))">
          <strong>
            Fecha estimada de terminación del contrato:
          </strong>
          <span> {{ updateFechaEstimada(descripcion.fechaFinSuspension, descripcion.fechaInicioSuspension )  | date: 'dd/MM/yyyy' }}</span>
        </p>
        <p *ngIf="descripcion.tipoNovedadCodigo == '6'">
          <strong>
            Fecha de reinicio
          </strong>
          {{ descripcion.fechaInicioSuspension | date: 'dd/MM/yyyy' }}
        </p>
        <p *ngIf="descripcion.tipoNovedadCodigo == '3'" ><strong>Presupuesto adicional solicitado: </strong> {{ descripcion.presupuestoAdicionalSolicitado | currency: '':'symbol':'3.0' }} </p>
        <p  *ngIf="descripcion.tipoNovedadCodigo == '3'">
          <strong >
            Valor después de la modificación
            <span *ngIf="datosContratoProyectoModificadosXNovedad?.tipoSolicitudCodigo == '1'">(Obra) </span>
            <span *ngIf="datosContratoProyectoModificadosXNovedad?.tipoSolicitudCodigo == '2'">(Interventoría) </span>:
          </strong>
          {{ valuePresupuesto(descripcion.presupuestoAdicionalSolicitado) | currency: '':'symbol':'3.0' }}
        </p>
        <section *ngIf="descripcion.tipoNovedadCodigo === '5'">
          <section *ngFor="let clausula of descripcion?.novedadContractualClausula; let i = index;">
            <mat-card-title class="header-card--text sub-text">
              Cláusula {{ i + 1 }}
            </mat-card-title>
            <p><strong>Cláusula a modificar: </strong> </p>
            <section [innerHTML]="clausula.clausulaAmodificar" style="margin-left: 2em"></section>
            <p><strong>Ajuste solicitado a la cláusula: </strong> </p>
            <section [innerHTML]="clausula.ajusteSolicitadoAclausula" style="margin-left: 2em"></section>
          </section>
        </section>

        <p><strong>¿Cuenta con la documentación soporte suficiente?: </strong> {{ descripcion.esDocumentacionSoporte === true ? 'Sí' : 'No' }}</p>
        <p><strong>Concepto técnico: </strong></p>
        <section
                  [innerHTML]="descripcion.conceptoTecnico"
                  style="margin-left: 2em"
          ></section>
        <p><strong>Fecha concepto técnico: </strong> {{ descripcion.fechaConcepto | date: 'dd/MM/yyyy' }}</p>
        <p><strong>Número de radicado en FFIE de solicitud: </strong> {{ descripcion.numeroRadicado }}</p>
      </mat-card-content>
    </mat-card>
  </mat-expansion-panel>
</mat-accordion>
