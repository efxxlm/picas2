<form [formGroup]="addressForm" novalidate (ngSubmit)="onSubmit()">

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="objeto" class="text-area-quill--label">Objeto</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 2000)" formControlName="objeto" required></quill-editor>
    </div>
    <span class="contador miles" *ngIf="addressForm.get('objeto').value">
      {{2000 - (textoLimpio(addressForm.get('objeto').value)>2000?2000:textoLimpio(addressForm.get('objeto').value))}}
    </span>
    <span class="contador miles" *ngIf="!addressForm.get('objeto').value">
      2000
    </span>
  </div>

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="alcanceParticular" class="text-area-quill--label">Alcance particular</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 3000)" formControlName="alcanceParticular" required></quill-editor>
    </div>
    <span class="contador miles" *ngIf="addressForm.get('alcanceParticular').value">
      {{3000 - (textoLimpio(addressForm.get('alcanceParticular').value)>3000?3000:textoLimpio(addressForm.get('alcanceParticular').value))}}
    </span>
    <span class="contador miles" *ngIf="!addressForm.get('alcanceParticular').value">
      3000
    </span>
  </div>

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="justificacion" class="text-area-quill--label">Justificación</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 3000)" formControlName="justificacion" required></quill-editor>
    </div>
    <span class="contador miles" *ngIf="addressForm.get('justificacion').value">
      {{3000 - (textoLimpio(addressForm.get('justificacion').value)>3000?3000:textoLimpio(addressForm.get('justificacion').value))}}
    </span>
    <span class="contador miles" *ngIf="addressForm.get('justificacion').value == null">
      3000
    </span>
  </div>

  <div class="d-flex align-items-center" *ngIf="procesoSeleccion.tipoProcesoCodigo == '2'">
    <div class="text-area-quill">
      <label for="justificacion" class="text-area-quill--label">Criterios para la selección</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 3000)" formControlName="criterios" required></quill-editor>
    </div>
    <span class="contador miles" *ngIf="addressForm.get('criterios').value">
      {{3000 - (textoLimpio(addressForm.get('criterios').value)>3000?3000:textoLimpio(addressForm.get('criterios').value))}}
    </span>
    <span class="contador miles" *ngIf="addressForm.get('criterios').value === null">
      3000
    </span>
  </div>

  <mat-card class="shipping-card">
    <mat-card-content>
          <div class="row">
            <div class="pr-1">
              <label for="tipoIntervencion" class="label-left">Tipo de Intervención</label>
            </div>
            <div class="col">
              <mat-form-field class="select-width">
                <mat-select formControlName="tipoIntervencion" required>
                  <mat-option *ngFor="let tipoI of listaTipoIntervencion" [value]="tipoI">
                    {{ tipoI.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
        </div>
      </div>
      <div class="row">
            <div class="pr-1">
              <label for="tipoAlcance" class="label-left">Tipo de alcance</label>
            </div>
            <div class="col">
              <mat-form-field class="select-width">
                <mat-select formControlName="tipoAlcance" required>
                  <mat-option *ngFor="let tipoA of listaTipoAlcance" [value]="tipoA">
                    {{ tipoA.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
        </div>
      </div>
          <div class="row">
            <div class="pr-1">
              <label class="label-left">¿En este proceso de selección se realiza distribución del territorio en
                grupos?</label>
            </div>
            <div class="col">
              <mat-radio-group class="radioInput" formControlName="distribucionEnGrupos">
                <mat-radio-button value="true">Sí</mat-radio-button>
                <mat-radio-button value="false">No</mat-radio-button>
              </mat-radio-group>
              <span class="required-form-group">*</span>
        </div>
      </div>
      <div class="row" *ngIf="addressForm.get('distribucionEnGrupos').value === 'true'">
            <div class="pr-1">
              <label for="cuantosGrupos" class="label-left">¿Cuántos grupos?</label>
            </div>
            <div class="col d-flex">
              <mat-form-field class="full-width">
                <input matInput #cuantosGrupos type="number" min="2" max="99" maxlength="2" formControlName="cuantosGrupos"
                (keypress)="validateNumberKeypress($event)"
                                onKeyPress="if(this.value.length>=this.maxLength) return false;"
                  (keyup)="CambioNumeroAportantes()" required>
              </mat-form-field>
              <span class="contador">{{2 - cuantosGrupos.value.length}}</span>
        </div>
      </div>

      <div formGroupName="grupos">
        <h2 class="card-subTitle">Grupos</h2>
        <div *ngFor="let grupo of grupos.controls; let i = index">
          <div [formGroupName]="i">
            
            <mat-card-title class="header-card--text sub-text">
              Grupo {{ i + 1 }}
            </mat-card-title>
                <div class="row">
                  <div class="pr-1">
                    <label for="nombreGrupo" class="label-left">Nombre del grupo</label>
                  </div>
                  <div class="col d-flex mainColor">
                    <mat-form-field class="full-width">
                      <input matInput #nombreGrupo type="text"  maxlength="500" formControlName="nombreGrupo" required>
                      <input type="hidden" formControlName="procesoSeleccionGrupoId">
                    </mat-form-field>
                    <span class="contador">{{500 - nombreGrupo.value.length}}</span>
              </div>
            </div>
            <div class="row">
                  <div class="pr-1">
                    <label for="tipoPresupuesto" class="label-left">Tipo de presupuesto</label>
                  </div>
                  <div class="col">
                    <mat-form-field class="select-width">
                      <mat-select formControlName="tipoPresupuesto" required>
                        <mat-option *ngFor="let tipoPresupuesto of listatipoPresupuesto" [value]="tipoPresupuesto">
                          {{ tipoPresupuesto.nombre }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
              </div>
            </div>
            <div class="row"
              *ngIf="grupos.controls[i].get('tipoPresupuesto').value && grupos.controls[i].get('tipoPresupuesto').value.codigo == '1' ">
              <div class="pr-1">
                <label for="valor" class="label-left">Valor</label>
              </div>
              <div class="col d-flex">
                <mat-form-field class="full-width">
                  <input matInput #valor currencyMask 
                  [options]="{ prefix: '$ ', thousands: '.', precision: '0', align: 'center' }"
                   maxlength="20" formControlName="valor" (focusout)="nosuperarlimite(i,1)" required>
                </mat-form-field>
                <span class="contador">{{20 - valor.value.length}}</span>
              </div>
            </div>
            <div class="row"
              *ngIf="grupos.controls[i].get('tipoPresupuesto').value && grupos.controls[i].get('tipoPresupuesto').value.codigo == '2' ">
              <div class="pr-1">
                <label for="valorMinimoCategoria" class="label-left">Valor mínimo categoría de ejecución</label>
              </div>
              <div class="col d-flex">
                <mat-form-field class="full-width">
                  <input matInput #valorMinimoCategoria currencyMask [options]="{ prefix: '$ ', thousands: '.', precision: '0', align: 'center' }" maxlength="20"  required
                    formControlName="valorMinimoCategoria" (focusout)="nosuperarlimite(i,3)">
                </mat-form-field>
                <span class="contador">{{20 - valorMinimoCategoria.value.length}}</span>
              </div>
            </div>
            <div class="row"
              *ngIf="grupos.controls[i].get('tipoPresupuesto').value && grupos.controls[i].get('tipoPresupuesto').value.codigo == '2' ">
              <div class="pr-1">
                <label for="valorMaximoCategoria" class="label-left">Valor máximo categoría de ejecución</label>
              </div>
              <div class="col d-flex">
                <mat-form-field class="full-width">
                  <input matInput #valorMaximoCategoria currencyMask [options]="{ prefix: '$ ', thousands: '.', precision: '0', align: 'center' }" maxlength="20"  required
                    formControlName="valorMaximoCategoria" (focusout)="nosuperarlimite(i,2)">
                </mat-form-field>
                <span class="contador">{{20 - valorMaximoCategoria.value.length}}</span>
              </div>
            </div>
            <div class="row">
                  <div class="pr-1">
                    <label for="plazoMeses" class="label-left">Plazo en meses</label>
                  </div>
                  <div class="col d-flex">
                    <mat-form-field class="full-width mainColor">
                      <input matInput #plazoMeses type="number" min="1" max="99" maxlength="2" 
                      (keypress)="validateNumberKeypress($event)"
                                onKeyPress="if(this.value.length>=this.maxLength) return false;"
                  (keyup)="CambioNumeroMeses(i)" formControlName="plazoMeses" required>
                    </mat-form-field>
                    <span class="contador">{{2 - plazoMeses.value.length}}</span>
              </div>
              <div class="col-md-4 text-right" *ngIf="addressForm.value.grupos.length > 1">
                <button mat-button color="warn" type="button" class="btn-eliminar" (click)="borrarArray(grupos, i)">
                  <img src="assets/img/icon/menos.svg" alt="Eliminar grupo">
                  Eliminar grupo
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div formGroupName="cronogramas" *ngIf="addressForm.get('grupos').status=='VALID'">
        <div>
          <h2 class="card-subTitle">Cronograma</h2>
          <div class="table-responsive">
            <table class="mat-table cdk-table mat-sort mat-table-style table-form table-form--2">
              <thead>
                <tr class="mat-header-row cdk-header-row ng-star-inserted">
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Actividad
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Descripción
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Fecha máxima
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Gestión
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let cronograma of cronogramas.controls; let i = index" [formGroupName]="i">
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <b class="text-1-2em d-flex justify-content-center">
                      {{ i +1 }}
                    </b>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <div class="d-flex justify-content-center">
                      <span class="contador mt-1em" *ngIf="cronograma.get('descripcion').value">
                        {{500 - (textoLimpio(cronograma.get('descripcion').value)>500?500:textoLimpio(cronograma.get('descripcion').value))}}
                      </span>                      
                      <span class="contador mt-1em" *ngIf="cronograma.get('descripcion').value === null || cronograma.get('descripcion').value == null">
                        500
                      </span><span class="required-form-group required-calendar" style="margin-top: 1.5em;">*</span>
                    </div>
                    <input type="hidden" formControlName="procesoSeleccionCronogramaId">
                    <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                      (onContentChanged)="maxLength($event, 500)" formControlName="descripcion"></quill-editor>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted position-relative">
                    <div class="d-flex justify-content-center btn-calendario-container toptd">
                      <button mat-button color="primary" type="button" (click)="picker.open()" class="btn-calendario ">
                        <img src="assets/img/icon/calendarioCirculo.svg" alt="Abrir Calendario">
                      </button>
                      <span class="required-form-group required-calendar" style="margin-top: 1.5em;">*</span>
                    </div>
                    <mat-form-field class="example-full-width">
                      <input matInput [matDatepicker]="picker" placeholder="DD/MM/AAAA" class="mainColor" formControlName="fechaMaxima" (click)="picker.open()" readonly>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <button mat-raised-button color="accent" type="button" (click)="borrarArray(cronogramas, i)">Eliminar</button>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>
          <div class="text-right">
            <button mat-button color="warn" type="button" class="btn-eliminar" (click)="agregarActividad()">
              <img src="assets/img/icon/mas.svg" alt="Agregar otra actividad">
              Agregar otra actividad
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="addressForm.get('cronogramas').status=='VALID'">
        <div>
          <h2 class="card-subTitle">Responsables</h2>

          <div class="row">
            <div class="col-md-8">
              <div class="row">
                <div class="pr-1">
                  <label for="responsableEquipoTecnico" class="label-left">Responsable del equipo técnico</label>
                </div>
                <div class="col">
                  <mat-form-field class="select-width">
                    <mat-select formControlName="responsableEquipoTecnico" required>
                      <mat-option *ngFor="let responsable of listaResponsables" [value]="responsable">
                        {{ responsable.nombres }} {{ responsable.apellidos }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8">
              <div class="row">
                <div class="pr-1">
                  <label for="responsableEquipoestructurado" class="label-left">Responsable del equipo
                    estructurador</label>
                </div>
                <div class="col">
                  <mat-form-field class="select-width">
                    <mat-select formControlName="responsableEquipoestructurado" required>
                      <mat-option *ngFor="let responsable of listaResponsables" [value]="responsable">
                        {{ responsable.nombres }} {{ responsable.apellidos }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="addressForm.get('responsableEquipoestructurado')!=null &&
          addressForm.get('responsableEquipoestructurado')!=null && 
          procesoSeleccion.tipoProcesoCodigo==tiposProceso.Abierta"><br>
            <div class="d-flex align-items-center">
              <div class="text-area-quill">
                <label for="condicionesJuridicas" class="text-area-quill--label">Condiciones jurídicas habilitantes</label>
                <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                  (onContentChanged)="maxLength($event, 3000)" formControlName="condicionesJuridicas" required></quill-editor>
              </div>
              <span class="contador miles" *ngIf="addressForm.get('condicionesJuridicas').value">
                {{3000 - (textoLimpio(addressForm.get('condicionesJuridicas').value)>3000?3000:textoLimpio(addressForm.get('condicionesJuridicas').value))}}
              </span>
              <span class="contador miles" *ngIf="!addressForm.get('condicionesJuridicas').value">
                3000
              </span>
            </div>
            <div class="d-flex align-items-center">
              <div class="text-area-quill">
                <label for="condicionesFinancieras" class="text-area-quill--label">Condiciones financieras habilitantes</label>
                <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                  (onContentChanged)="maxLength($event, 3000)" formControlName="condicionesFinancieras" required></quill-editor>
              </div>
              <span class="contador miles" *ngIf="addressForm.get('condicionesFinancieras').value">
                {{3000 - (textoLimpio(addressForm.get('condicionesFinancieras').value)>3000?3000:textoLimpio(addressForm.get('condicionesFinancieras').value))}}
              </span>
              <span class="contador miles" *ngIf="!addressForm.get('condicionesFinancieras').value">
                3000
              </span>
            </div>
            <div class="d-flex align-items-center">
              <div class="text-area-quill">
                <label for="condicionesTecnicas" class="text-area-quill--label">Condiciones técnicas habilitantes</label>
                <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                  (onContentChanged)="maxLength($event, 3000)" formControlName="condicionesTecnicas" required></quill-editor>
              </div>
              <span class="contador miles" *ngIf="addressForm.get('condicionesTecnicas').value">
                {{3000 - (textoLimpio(addressForm.get('condicionesTecnicas').value)>3000?3000:textoLimpio(addressForm.get('condicionesTecnicas').value))}}
              </span>
              <span class="contador miles" *ngIf="!addressForm.get('condicionesTecnicas').value">
                3000
              </span>
            </div>
            <div class="d-flex align-items-center">
              <div class="text-area-quill">
                <label for="condicionesAsignacion" class="text-area-quill--label">Condiciones de asignación de puntaje</label>
                <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                  (onContentChanged)="maxLength($event, 3000)" formControlName="condicionesAsignacion" required></quill-editor>
              </div>
              <span class="contador miles" *ngIf="addressForm.get('condicionesAsignacion').value">
                {{3000 - (textoLimpio(addressForm.get('condicionesAsignacion').value)>3000?3000:textoLimpio(addressForm.get('condicionesAsignacion').value))}}
              </span>
              <span class="contador miles" *ngIf="!addressForm.get('condicionesAsignacion').value">
                3000
              </span>
            </div>
          </div>


        </div>
      </div>

    </mat-card-content>
  </mat-card>

  <div class="text-center">
    <button mat-button color="warn" class="btn-guardar" type="submit">
      <img src="assets/img/icon/guardar.svg" alt="Regresar">
    </button>
  </div>
</form>

<!-- <pre>
  {{ addressForm.value | json }}
</pre> -->