<form [formGroup]="addressForm" (ngSubmit)="onSubmit()">

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="objeto" class="text-area-quill--label">Objeto</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 2000)" formControlName="objeto"></quill-editor>
    </div>
    <span class="contador" *ngIf="addressForm.get('objeto').value !== null">
      {{2000 - addressForm.get('objeto').value.length}}
    </span>
    <span class="contador" *ngIf="addressForm.get('objeto').value === null">
      2000
    </span>
  </div>

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="alcanceParticular" class="text-area-quill--label">Alcance particular</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 3000)" formControlName="alcanceParticular"></quill-editor>
    </div>
    <span class="contador" *ngIf="addressForm.get('alcanceParticular').value !== null">
      {{3000 - addressForm.get('alcanceParticular').value.length}}
    </span>
    <span class="contador" *ngIf="addressForm.get('alcanceParticular').value === null">
      3000
    </span>
  </div>

  <div class="d-flex align-items-center">
    <div class="text-area-quill">
      <label for="justificacion" class="text-area-quill--label">Justificación</label>
      <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
        (onContentChanged)="maxLength($event, 3000)" formControlName="justificacion"></quill-editor>
    </div>
    <span class="contador" *ngIf="addressForm.get('justificacion').value !== null">
      {{3000 - addressForm.get('justificacion').value.length}}
    </span>
    <span class="contador" *ngIf="addressForm.get('justificacion').value === null">
      3000
    </span>
  </div>

  <mat-card class="shipping-card">
    <mat-card-content>
      <div class="row">
        <div class="col-md-8">
          <div class="row">
            <div class="pr-1">
              <label for="tipoIntervencion" class="label-left">Tipo de Intervención</label>
            </div>
            <div class="col">
              <mat-form-field class="select-width">
                <mat-select formControlName="tipoIntervencion" required>
                  <mat-option *ngFor="let tipoI of listaTipoIntervencion" [value]="tipoI">
                    {{ tipoI.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8">
          <div class="row">
            <div class="pr-1">
              <label for="tipoAlcance" class="label-left">Tipo de alcance</label>
            </div>
            <div class="col">
              <mat-form-field class="select-width">
                <mat-select formControlName="tipoAlcance" required>
                  <mat-option *ngFor="let tipoA of listaTipoAlcance" [value]="tipoA">
                    {{ tipoA.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8">
          <div class="row">
            <div class="pr-1">
              <label class="label-left">¿En este proceso de selección se realiza distribución del territorio en grupos?</label>
            </div>
            <div class="col">
              <mat-radio-group class="radioInput" formControlName="distribucionEnGrupos">
                <mat-radio-button value="true">Sí</mat-radio-button>
                <mat-radio-button value="false">No</mat-radio-button>
              </mat-radio-group>
            </div>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="addressForm.get('distribucionEnGrupos').value === 'true'">
        <div class="col-md-8">
          <div class="row">
            <div class="pr-1">
              <label for="cuantosGrupos" class="label-left">¿Cuántos grupos?</label>
            </div>
            <div class="col d-flex">
              <mat-form-field class="full-width">
                <input matInput #cuantosGrupos type="number" min="1" max="99" formControlName="cuantosGrupos" (keyup)="CambioNumeroAportantes()">
              </mat-form-field>
              <span class="contador">{{2 - cuantosGrupos.value.length}}</span>
            </div>
          </div>
        </div>
      </div>

      <div formGroupName="grupos">
        <div *ngFor="let grupo of grupos.controls; let i = index">
          <div [formGroupName]="i">
            <h2 class="card-subTitle">Grupos</h2>
            <mat-card-title class="header-card--text sub-text">
              Grupo {{ i + 1 }}
            </mat-card-title>
            <div class="row">
              <div class="pr-1">
                <label for="nombreGrupo" class="label-left">Nombre del grupo</label>
              </div>
              <div class="col d-flex">
                <mat-form-field class="full-width">
                  <input matInput #nombreGrupo type="text" maxlength="100" formControlName="nombreGrupo">
                  <input type="hidden" formControlName="procesoSeleccionGrupoId">
                  
                </mat-form-field>
                <span class="contador">{{100 - nombreGrupo.value.length}}</span>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8">
                <div class="row">
                  <div class="pr-1">
                    <label for="tipoPresupuesto" class="label-left">Tipo de presupuesto</label>
                  </div>
                  <div class="col">
                    <mat-form-field class="select-width">
                      <mat-select formControlName="tipoPresupuesto" required>
                        <mat-option *ngFor="let tipoPresupuesto of listatipoPresupuesto" [value]="tipoPresupuesto">
                          {{ tipoPresupuesto.nombre }}
                        </mat-option>
                      </mat-select> 
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8">
                <div class="row">
                  <div class="pr-1">
                    <label for="plazoMeses" class="label-left">Plazo en meses</label>
                  </div>
                  <div class="col d-flex">
                    <mat-form-field class="full-width">
                      <input matInput #plazoMeses type="number" min="1" max="99" formControlName="plazoMeses">
                    </mat-form-field>
                    <span class="contador">{{2 - plazoMeses.value.length}}</span>
                  </div>
                </div>
              </div>
              <div class="col-md-4 text-right" *ngIf="addressForm.value.grupos.length > 1">
                <button mat-button color="warn" type="button" class="btn-eliminar"
                  (click)="borrarArray(grupos, i)">
                  <img src="assets/img/icon/menos.svg" alt="Eliminar grupo">
                  Eliminar grupo
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div formGroupName="cronogramas">
          <div>
            <h2 class="card-subTitle">Cronograma</h2>
            <table class="mat-table cdk-table mat-sort mat-table-style">
              <thead>
                <tr class="mat-header-row cdk-header-row ng-star-inserted">
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Actividad
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Descripción
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Fecha máxima
                  </th>
                  <th class="mat-header-cell cdk-header-cell ng-star-inserted">
                    Gestión
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let cronograma of cronogramas.controls; let i = index" [formGroupName]="i" >
                  
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <b class="text-1-2em">
                      {{ i +1 }}
                    </b>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <div class="d-flex justify-content-center">
                    </div>
                    <input type="hidden" formControlName="procesoSeleccionCronogramaId">
                    <quill-editor class="quill-editor-style" [styles]="editorStyle" [modules]="config"
                      (onContentChanged)="maxLength($event, 500)" formControlName="descripcion"></quill-editor>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <button mat-button color="primary" (click)="picker.open()" class="btn-calendario">
                      <img src="assets/img/icon/calendarioCirculo.svg" alt="Abrir Calendario" >
                    </button>
                    <mat-form-field class="example-full-width">
                      <input matInput [matDatepicker]="picker" formControlName="fechaMaxima">
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </td>
                  <td class="mat-cell cdk-cell ng-star-inserted">
                    <button mat-raised-button color="accent">Eliminar</button>
                  </td>
                
                </tr>
              </tbody>
            </table>
            <div class="text-right">
              <button mat-button color="warn" type="button" class="btn-eliminar" (click)="agregarActividad()">
                <img src="assets/img/icon/mas.svg" alt="Agregar otra actividad">
                Agregar otra actividad
              </button>
            </div>
          </div>
      </div>
    
    </mat-card-content>
  </mat-card>

  <div class="text-center">
    <button mat-button color="warn" class="btn-guardar" type="submit">
      <img src="assets/img/icon/guardar.svg" alt="Regresar">
    </button>
  </div>
</form>

<!-- <pre>
  {{ addressForm.value | json }}
</pre> -->