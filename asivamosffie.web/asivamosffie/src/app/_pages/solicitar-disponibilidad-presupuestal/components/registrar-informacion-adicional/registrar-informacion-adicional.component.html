<div class="container" *ngIf="objetoDisponibilidad">
  <div class="text-right">
    <a
      routerLink="/solicitarDisponibilidadPresupuestal/crearSolicitudTradicional"
      mat-button
      color="primary"
      class="btn-regresar"
    >
      <img src="assets/img/icon/regresar.svg" alt="Regresar" />
    </a>
  </div>
  <div class="text-center">
    <h1 class="title-menu--h1">Registrar información adicional solicitud {{ objetoDisponibilidad.numeroSolicitud }}</h1>
  </div>

  <div class="d-flex justify-content-center">
    <p class="solicitud" *ngIf="objetoDisponibilidad.tipoSolicitudCodigo === '1' && !objetoDisponibilidad.esNovedadContractual">
      <strong>Contratación</strong>
    </p>
    <p class="solicitud" *ngIf="objetoDisponibilidad.tipoSolicitudCodigo === '1' && objetoDisponibilidad.esNovedadContractual">
      <strong>Modificación Contractual</strong>
    </p>
    <p class="solicitud" *ngIf="objetoDisponibilidad.fechaComiteTecnicoNotMapped">
      <strong>Fecha de comité técnico:</strong>
      {{ objetoDisponibilidad.fechaComiteTecnicoNotMapped | date: 'dd/MM/yyyy' }}
    </p>
  </div>

  <mat-card class="shipping-card var-main-gris mt-1em" *ngIf="objetoDisponibilidad.esNovedadContractual">
    <mat-card-content>
      <p><b>DDP:</b>{{ddpsolicitud}}</p>
      <p><b>Valor DDP:</b> {{ddpvalor|currency:'':'symbol':'3.0'}}</p>
      <p><b>Detalle de la modificación:</b></p>
      <p>{{ddpdetalle}}</p>
    </mat-card-content>
  </mat-card>

  <mat-accordion>
    <mat-expansion-panel class="expansion-style" *ngFor="let proyecto of listaProyectos">
      <mat-expansion-panel-header class="expansion-style--header">
        <mat-panel-title class="expansion-style--title">
          {{ proyecto.llaveMen }} - {{ proyecto.institucionEducativa.nombre }} - {{ proyecto.sede.nombre }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <section style="width: 80%; margin: auto">
        <p class="text-center color-mainColor departamento">
          {{ proyecto.localizacionIdMunicipio }}
        </p>
        <mat-card class="shipping-card var-main-gris sub-card" style="margin-top: 2em">
          <mat-card-header class="header-card header-card--margin-1">
            <mat-card-title class="header-card--text"> Aportantes </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="row">
              <div
                class="col-md-6 mb-1em"
                *ngFor="let aportante of proyecto.proyectoAportante; index as i"
                style="margin-top: 0.5em"
              >
                <p class="mb1-em font20">
                  <b>Aportante {{ i + 1 }} </b>
                </p>

                <p style="margin-top: 0.5em">
                  <b>Tipo de aportante:</b>

                  {{ aportante.aportante.tipoAportanteString }}
                </p>
                <p>
                  <b>Aportante:</b>
                  {{ aportante.aportante.nombreAportanteString }}
                </p>
                <p>
                  <b>Valor del aportante:</b>
                  <!-- obra -->
                  <span *ngIf="tipoSolicitudCodigo === '1'">{{ aportante.valorObra | currency }}</span>

                  <!-- interventoria -->
                  <span *ngIf="tipoSolicitudCodigo === '2'">{{ aportante.valorInterventoria | currency }}</span>
                </p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </section>
    </mat-expansion-panel>
  </mat-accordion>

  <form [formGroup]="addressForm" novalidate (ngSubmit)="onSubmit()">
    <div class="row justify-content-center mt-2em mb-2em">
      <div class="col-md-4">
        <div class="row">
          <div class="pr-1">
            <label
              for="plazoMeses"
              class="label-left"
              [class.color-secondaryColor]="
                (addressForm.get('plazoMeses').invalid && addressForm.get('plazoMeses').touched) ||
                (addressForm.get('plazoMeses').invalid && estaEditando)
              "
            >
              Plazo meses
            </label>
          </div>
          <div class="col d-flex">
            <mat-form-field class="full-width">
              <input
                matInput
                #plazoMeses
                type="number"
                min="1"
                max="999"
                maxlength="3"
                required
                formControlName="plazoMeses"
                name="plazoMeses"
                (keypress)="validateNumberKeypress($event)"
                onKeyPress="if(this.value.length>=this.maxLength) return false;"
                oninput="if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                [readonly]="ddpsolicitud"
              />
            </mat-form-field>
            <span
              class="contador"
              [matTooltipPosition]="'above'"
              matTooltip="Campo numérico"
              matTooltipClass="info-tooltip"
            >
              {{ 3 - plazoMeses.value.length }}
            </span>
            <span class="icon-incompleto">
              <img
                class="icon-incompleto--img"
                src="assets/img/icon/incompleto.svg"
                alt="este campo es requerido"
                [matTooltipPosition]="'above'"
                matTooltip="Debe ingresar la información en el campo para continuar"
                matTooltipClass="info-tooltip"
                *ngIf="
                  (addressForm.get('plazoMeses').invalid && addressForm.get('plazoMeses').touched) ||
                  (addressForm.get('plazoMeses').invalid && estaEditando)
                "
              />
            </span>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row">
          <div class="pr-1">
            <label
              for="plazoDias"
              class="label-left"
              [class.color-secondaryColor]="
                (addressForm.get('plazoDias').invalid && addressForm.get('plazoDias').touched) ||
                (addressForm.get('plazoDias').invalid && estaEditando)
              "
            >
              Plazo días
            </label>
          </div>
          <div class="col d-flex">
            <mat-form-field class="full-width">
              <input
                matInput
                #plazoDias
                type="number"
                min="1"
                max="99"
                maxlength="2"
                required
                formControlName="plazoDias"
                name="plazoDias"
                (change)="validatenomore30()"
                (keypress)="validateNumberKeypress($event)"
                onKeyPress="if(this.value.length>=this.maxLength) return false;"
                oninput="if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                [readonly]="ddpsolicitud"
              />
            </mat-form-field>
            <span
              class="contador"
              [matTooltipPosition]="'above'"
              matTooltip="Campo numérico"
              matTooltipClass="info-tooltip"
            >
              {{ 2 - plazoDias.value.length }}
            </span>
            <span class="icon-incompleto">
              <img
                class="icon-incompleto--img"
                src="assets/img/icon/incompleto.svg"
                alt="este campo es requerido"
                [matTooltipPosition]="'above'"
                matTooltip="Debe ingresar la información en el campo para continuar"
                matTooltipClass="info-tooltip"
                *ngIf="
                  (addressForm.get('plazoDias').invalid && addressForm.get('plazoDias').touched) ||
                  (addressForm.get('plazoDias').invalid && estaEditando)
                "
              />
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex mt-2em align-items-center">
      <div
        class="text-area-quill"
        [class.color-secondaryColor]="
          (addressForm.get('objeto').invalid && addressForm.get('objeto').touched) ||
          (addressForm.get('objeto').invalid && estaEditando)
        "
      >
        <label
          for="objeto"
          class="text-area-quill--label align-left-label"
          [class.colorMainColor]="
            !(
              (addressForm.get('objeto').invalid && addressForm.get('objeto').touched) ||
              (addressForm.get('objeto').invalid && estaEditando)
            )
          "
        >
          Objeto
        </label>
        <quill-editor
          class="quill-editor-style ml-1em"
          [styles]="editorStyle"
          [modules]="config"
          (onContentChanged)="maxLength($event, 1000)"
          formControlName="objeto"
          #obsGestionSst
          required
          [readonly]="ddpsolicitud"
        ></quill-editor>
      </div>
      <span class="contador miles" *ngIf="addressForm.get('objeto').value">
        {{ 1000 - textoLimpio(obsGestionSst.quillEditor, 1000) }}
      </span>
      <span class="contador miles" *ngIf="!addressForm.get('objeto').value"> 1000 </span>
      <span class="icon-incompleto">
        <img
          class="icon-incompleto--img"
          src="assets/img/icon/incompleto.svg"
          alt="este campo es requerido"
          [matTooltipPosition]="'above'"
          matTooltip="Debe ingresar la información en el campo para continuar"
          matTooltipClass="info-tooltip"
          *ngIf="
            (addressForm.get('objeto').invalid && addressForm.get('objeto').touched) ||
            (addressForm.get('objeto').invalid && estaEditando)
          "
        />
      </span>
    </div>
    <div class="text-center mb-2em">
      <button mat-button color="warn" class="btn-guardar" type="submit">
        <img src="assets/img/icon/guardar.svg" alt="Guardar" />
      </button>
    </div>
  </form>
  <app-tabla-observaciones
    [DisponibilidadPresupuestal]="objetoDisponibilidad"
    *ngIf="objetoDisponibilidad && objetoDisponibilidad.estadoSolicitudCodigo === '2'"
  >
  </app-tabla-observaciones>
</div>
